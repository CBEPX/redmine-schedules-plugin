<table class="cal schedule_entry-grid">
	<thead>
		<tr><td></td><% 7.times do |i| %><th><%= day_name( (calendar.first_wday+i)%7 )%></th><% end %></tr>
	</thead>
	<tbody>
		<% @projects.each do |project| %>
		<tr>
			<%= "<th>#{project}</th>" %>
			<% day = calendar.startdt
			while day <= calendar.enddt %>
			<td class="even<%= ' today' if Date.today == day %>">
				<%
					entry = ScheduleEntry.find(:first, :conditions => ["project_id=? AND user_id=? AND date=?", project.id, @user.id, day])
					if (entry.nil?)
						entry = ScheduleEntry.new
						entry.project_id = project.id
						entry.user_id = @user.id
						entry.date = day
					end
				%>
				<% if User.current.allowed_to?(:edit_all_schedules, project) || (User.current == user && User.current.allowed_to?(:edit_own_schedules, project)) || User.current.admin? %>
					<%= text_field "schedule_entry", "hours", "size" => 3, "name" => entry.form_id, "id" => entry.form_id, "value" => entry.hours %>
				<% else %>
					<%= %Q{<input type="text" size="3" disabled="disabled" value="#{entry.hours}" />} %>
				<% end %>
			</td>
			<% day = day + 1
			end %>
		</tr>
		<% end %>
	</tbody>
	<tfoot>
		<tr><th>Available</th>
		<% day = calendar.startdt
		while day <= calendar.enddt %>
		<td class="even<%= ' today' if Date.today == day %>">
			<%
				entry = AvailabilityEntry.find(:first, :conditions => ["user_id=? AND date=?", @user.id, day])
				if (entry.nil?)
					entry = AvailabilityEntry.new
					entry.user_id = @user.id
					entry.date = day
				end
			%>
			<% if User.current == @user || User.current.admin? %>
				<%= text_field "availability_entry", "hours", "size" => 3, "name" => entry.form_id, "id" => entry.form_id, "value" => entry.hours %>
			<% else %>
				<%= %Q{<input type="text" size="3" disabled="disabled" value="" />} %>
			<% end %>
		<% day = day + 1
		end %>
	</tfoot>
</table>